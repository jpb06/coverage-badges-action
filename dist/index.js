"use strict";var a=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var ee=a(h=>{"use strict";var Ie=h&&h.__awaiter||function(e,r,t,n){function c(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function d(o){try{u(n.next(o))}catch(f){s(f)}}function l(o){try{u(n.throw(o))}catch(f){s(f)}}function u(o){o.done?i(o.value):c(o.value).then(d,l)}u((n=n.apply(e,r||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});h.pathExistsEffect=void 0;var $e=require("../node_modules/effect/dist/cjs/index.js"),Fe=require("../node_modules/fs-extra/lib/index.js"),Re=require("../node_modules/node-coverage-badges/index.js"),Se=e=>$e.Effect.tryPromise({try:()=>Ie(void 0,void 0,void 0,function*(){return yield(0,Fe.pathExists)(e)}),catch:r=>new Re.FsError({cause:r})});h.pathExistsEffect=Se});var te=a(v=>{"use strict";var De=v&&v.__awaiter||function(e,r,t,n){function c(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function d(o){try{u(n.next(o))}catch(f){s(f)}}function l(o){try{u(n.throw(o))}catch(f){s(f)}}function u(o){o.done?i(o.value):c(o.value).then(d,l)}u((n=n.apply(e,r||[])).next())})};Object.defineProperty(v,"__esModule",{value:!0});v.readJsonEffect=void 0;var ke=require("../node_modules/effect/dist/cjs/index.js"),He=require("../node_modules/fs-extra/lib/index.js"),Ne=require("../node_modules/node-coverage-badges/index.js"),Ue=e=>ke.Effect.tryPromise({try:()=>De(void 0,void 0,void 0,function*(){return yield(0,He.readJson)(e)}),catch:r=>new Ne.FsError({cause:r})});v.readJsonEffect=Ue});var W=a(_=>{"use strict";var Je=_&&_.__createBinding||(Object.create?function(e,r,t,n){n===void 0&&(n=t);var c=Object.getOwnPropertyDescriptor(r,t);(!c||("get"in c?!r.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,n,c)}:function(e,r,t,n){n===void 0&&(n=t),e[n]=r[t]}),re=_&&_.__exportStar||function(e,r){for(var t in e)t!=="default"&&!Object.prototype.hasOwnProperty.call(r,t)&&Je(r,e,t)};Object.defineProperty(_,"__esModule",{value:!0});re(ee(),_);re(te(),_)});var ne=a(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.doBadgesExist=void 0;var b=require("../node_modules/effect/dist/cjs/index.js"),We=W(),Ve=["coverage-branches.svg","coverage-functions.svg","coverage-total.svg","coverage-lines.svg","coverage-statements.svg"],ze=e=>e===void 0?"":e?.endsWith("/")?e:`${e}/`,Ke=(e,r)=>(0,b.pipe)(b.Effect.forEach(r,({subPath:t})=>(0,b.pipe)(b.Effect.all(Ve.map(n=>(0,We.pathExistsEffect)(`${e}/${ze(t)}${n}`)),{concurrency:"unbounded"}),b.Effect.map(n=>n.every(c=>c))),{concurrency:"unbounded"}),b.Effect.map(t=>t.every(n=>n)));B.doBadgesExist=Ke});var ie=a(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.GlobError=void 0;var Le=require("../node_modules/effect/dist/cjs/Data.js"),V=class extends(0,Le.TaggedError)("glob-error"){};P.GlobError=V});var oe=a(E=>{"use strict";var Qe=E&&E.__awaiter||function(e,r,t,n){function c(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function d(o){try{u(n.next(o))}catch(f){s(f)}}function l(o){try{u(n.throw(o))}catch(f){s(f)}}function u(o){o.done?i(o.value):c(o.value).then(d,l)}u((n=n.apply(e,r||[])).next())})};Object.defineProperty(E,"__esModule",{value:!0});E.globEffect=void 0;var Xe=require("../node_modules/effect/dist/cjs/index.js"),Ye=require("../node_modules/glob/dist/commonjs/index.js"),Ze=ie(),et=e=>Xe.Effect.tryPromise({try:()=>Qe(void 0,void 0,void 0,function*(){return yield(0,Ye.glob)(e)}),catch:r=>new Ze.GlobError({cause:r})});E.globEffect=et});var ce=a(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.NoJsonSummariesProvidedError=void 0;var tt=require("../node_modules/effect/dist/cjs/Data.js"),z=class extends(0,tt.TaggedError)("no-json-summaries-provided"){};O.NoJsonSummariesProvidedError=z});var ae=a(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.isCoverageReportAvailableForFile=void 0;var rt=require("../node_modules/effect/dist/cjs/index.js"),se=W(),j=e=>e?.pct===void 0,nt=e=>rt.Effect.gen(function*(){if(!(yield*(0,se.pathExistsEffect)(e)))return!1;let t=yield*(0,se.readJsonEffect)(e);return!(t?.total===void 0||j(t.total.branches)||j(t.total.functions)||j(t.total.lines)||j(t.total.statements))});M.isCoverageReportAvailableForFile=nt});var ue=a(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.validatePath=void 0;var it=require("../node_modules/effect/dist/cjs/index.js"),ot=ae(),ct=e=>r=>it.Effect.gen(function*(){var t;if(!(yield*(0,ot.isCoverageReportAvailableForFile)(r)))return;if(e.includes("**")){let d=e.split("**"),l=`^${d[0].slice(2)}(.*)${d[1]}$`,u=new RegExp(l);return{path:r,subPath:(t=u.exec(r))===null||t===void 0?void 0:t[1]}}let i=r.substring(0,r.lastIndexOf("/coverage/coverage-summary.json"));return{path:r,subPath:i!=="."&&i!==""?i:void 0}});x.validatePath=ct});var fe=a(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.getValidPaths=void 0;var st=require("../node_modules/@actions/core/lib/core.js"),q=require("../node_modules/effect/dist/cjs/index.js"),at=oe(),ut=ce(),ft=ue();T.getValidPaths=q.Effect.gen(function*(){let e=(0,st.getMultilineInput)("coverage-summary-path"),t=(yield*q.Effect.forEach(e,n=>q.Effect.gen(function*(){let c=yield*(0,at.globEffect)(n);return yield*q.Effect.forEach(c,(0,ft.validatePath)(n),{concurrency:"unbounded"})}),{concurrency:"unbounded"})).flat().filter(n=>n!==void 0);return t.length===0?yield*q.Effect.fail(new ut.NoJsonSummariesProvidedError({message:"\u274C No valid coverage reports provided. Perhaps you forgot to run tests or to add `json-summary` to coverageReporters in your test runner config?"})):t})});var le=a(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.generateBadges=void 0;var C=require("../node_modules/@actions/core/lib/core.js"),de=require("../node_modules/effect/dist/cjs/index.js"),dt=require("../node_modules/node-coverage-badges/index.js"),lt=(e,r)=>de.Effect.gen(function*(){e.length>1&&((0,C.info)(`\u2705 Found ${e.length} summary files`),e.forEach(({path:c,subPath:i})=>{(0,C.info)(`\u{1F4C1} ${c} (subPath = ${i})`)})),(0,C.info)("\u{1F680} Generating badges ...");let t=(0,C.getInput)("badges-icon"),n=t===""?void 0:t;yield*de.Effect.forEach(e,({path:c,subPath:i})=>{let s=i!==void 0?`${r}/${i}`:r;return(0,dt.generateBadgesEffect)(c,s,n)},{concurrency:"unbounded"})});A.generateBadges=lt});var _e=a(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.GithubMissingCurrentBranchError=void 0;var _t=require("../node_modules/effect/dist/cjs/Data.js"),K=class extends(0,_t.TaggedError)("github-missing-current-branch"){};G.GithubMissingCurrentBranchError=K});var he=a(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0});I.getCurrentBranch=void 0;var L=require("../node_modules/@actions/core/lib/core.js"),Q=require("../node_modules/effect/dist/cjs/index.js"),gt=_e(),ge=e=>e===void 0||e==="undefined"||e==="";I.getCurrentBranch=Q.Effect.gen(function*(){let e=process.env.GITHUB_HEAD_REF;return ge(e)&&(e=process.env.GITHUB_REF_NAME),ge(e)?((0,L.warning)(`\u{1F5EF}\uFE0F GITHUB_HEAD_REF: ${process.env.GITHUB_HEAD_REF}`),(0,L.warning)(`\u{1F5EF}\uFE0F GITHUB_REF_NAME: ${process.env.GITHUB_REF_NAME}`),yield*Q.Effect.fail(new gt.GithubMissingCurrentBranchError({message:"\u{1F6A8} Unable to get current branch from github event."}))):((0,L.info)(`\u2139\uFE0F Current branch is ${e}`),yield*Q.Effect.succeed(e))})});var Ee=a(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.checkBranchStatus=y.BranchNotAllowedForGenerationError=void 0;var ve=require("../node_modules/@actions/core/lib/core.js"),be=require("../node_modules/effect/dist/cjs/index.js"),ht=require("../node_modules/effect/dist/cjs/Data.js"),$=class extends(0,ht.TaggedError)("branch-not-allowed-for-generation"){};y.BranchNotAllowedForGenerationError=$;var vt=(e,r)=>be.Effect.gen(function*(){if(!r)return;let t=(0,ve.getInput)("branches");if(t==="*")return;let n=t.split(",");if(n.length===1&&n[0].length===0&&((0,ve.info)("\u2139\uFE0F No branches specified, defaulting to master and main"),n=["master","main"]),!n.includes(e))return yield*be.Effect.fail(new $({message:"\u{1F6D1} Current branch does not belong to the branches allowed for badges generation, task dropped."}))});y.checkBranchStatus=vt});var ye=a(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.GithubActionError=void 0;var bt=require("../node_modules/effect/dist/cjs/Data.js"),X=class extends(0,bt.TaggedError)("github-action-error"){};F.GithubActionError=X});var pe=a(p=>{"use strict";var Et=p&&p.__awaiter||function(e,r,t,n){function c(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function d(o){try{u(n.next(o))}catch(f){s(f)}}function l(o){try{u(n.throw(o))}catch(f){s(f)}}function u(o){o.done?i(o.value):c(o.value).then(d,l)}u((n=n.apply(e,r||[])).next())})};Object.defineProperty(p,"__esModule",{value:!0});p.execEffect=void 0;var yt=require("../node_modules/@actions/exec/lib/exec.js"),pt=require("../node_modules/effect/dist/cjs/index.js"),mt=ye(),qt=(e,r,t)=>pt.Effect.tryPromise({try:()=>Et(void 0,void 0,void 0,function*(){return yield(0,yt.exec)(e,r,t)}),catch:n=>new mt.GithubActionError({cause:n})});p.execEffect=qt});var R=a(g=>{"use strict";var wt=g&&g.__createBinding||(Object.create?function(e,r,t,n){n===void 0&&(n=t);var c=Object.getOwnPropertyDescriptor(r,t);(!c||("get"in c?!r.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,n,c)}:function(e,r,t,n){n===void 0&&(n=t),e[n]=r[t]}),Bt=g&&g.__exportStar||function(e,r){for(var t in e)t!=="default"&&!Object.prototype.hasOwnProperty.call(r,t)&&wt(r,e,t)};Object.defineProperty(g,"__esModule",{value:!0});Bt(pe(),g)});var me=a(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.hasCoverageEvolved=void 0;var Pt=require("../node_modules/effect/dist/cjs/index.js"),Ot=R(),jt=(e,r)=>Pt.Effect.gen(function*(){return e?(yield*(0,Ot.execEffect)("git diff",["--quiet",`${r}/*`],{ignoreReturnCode:!0}))===1:!0});S.hasCoverageEvolved=jt});var qe=a(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.pushBadges=void 0;var Mt=require("../node_modules/@actions/core/lib/core.js"),xt=require("../node_modules/effect/dist/cjs/index.js"),w=R(),Tt=(e,r="./badges")=>xt.Effect.all([(0,w.execEffect)("git checkout",[e]),(0,w.execEffect)("git status"),(0,w.execEffect)("git add",[r]),(0,w.execEffect)("git commit",["-m",(0,Mt.getInput)("commit-message")]),(0,w.execEffect)(`git push origin ${e}`)]);D.pushBadges=Tt});var je=a(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.setGitConfig=void 0;var we=require("../node_modules/@actions/core/lib/core.js"),Be=require("../node_modules/@actions/github/lib/github.js"),Pe=require("../node_modules/effect/dist/cjs/index.js"),Oe=R(),Ct=()=>Pe.Effect.gen(function*(){let e=(0,we.getInput)("commit-user-email"),r=(0,we.getInput)("commit-user");yield*Pe.Effect.all([(0,Oe.execEffect)("git config",["--global","user.name",r.length===0?Be.context.actor:r]),(0,Oe.execEffect)("git config",["--global","user.email",e.length===0?`${Be.context.actor}@users.noreply.github.com`:e])])});k.setGitConfig=Ct});var Me=a(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.getTargetBranch=void 0;var At=require("../node_modules/@actions/core/lib/core.js"),Gt=e=>{let r=(0,At.getInput)("target-branch");return r!==""?r:e};H.getTargetBranch=Gt});var xe=a(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.maybePushBadges=void 0;var Y=require("../node_modules/@actions/core/lib/core.js"),It=require("../node_modules/effect/dist/cjs/index.js"),$t=me(),Ft=qe(),Rt=je(),St=Me(),Dt=(e,r,t,n)=>It.Effect.gen(function*(){if(!e){(0,Y.info)("\u2139\uFE0F `no-commit` set to true: badges won't be committed");return}if(!(yield*(0,$t.hasCoverageEvolved)(r,t))){(0,Y.info)("\u2705 Coverage has not evolved, no action required.");return}(0,Y.info)("\u{1F680} Pushing badges to the repo"),yield*(0,Rt.setGitConfig)();let i=(0,St.getTargetBranch)(n);yield*(0,Ft.pushBadges)(i,t)});N.maybePushBadges=Dt});var Ce=a(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.mainTask=void 0;var Te=require("../node_modules/@actions/core/lib/core.js"),kt=require("../node_modules/effect/dist/cjs/index.js"),Ht=ne(),Nt=fe(),Ut=le(),Jt=he(),Wt=Ee(),Vt=xe(),zt=()=>kt.Effect.gen(function*(){let e=yield*Jt.getCurrentBranch,r=(0,Te.getInput)("no-commit")!=="true";yield*(0,Wt.checkBranchStatus)(e,r);let t=yield*Nt.getValidPaths,n=(0,Te.getInput)("output-folder"),c=yield*(0,Ht.doBadgesExist)(n,t);yield*(0,Ut.generateBadges)(t,n),yield*(0,Vt.maybePushBadges)(r,c,n,e)});U.mainTask=zt});var Ae=a(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.catchMainTaskErrors=void 0;var Kt=require("../node_modules/@actions/core/lib/core.js"),Z=require("../node_modules/effect/dist/cjs/index.js"),Lt=Ce(),Qt=()=>(0,Z.pipe)((0,Lt.mainTask)(),Z.Effect.catchTag("branch-not-allowed-for-generation",e=>Z.Effect.sync(()=>{(0,Kt.info)(e.message)})));J.catchMainTaskErrors=Qt});var Ge=a(m=>{"use strict";var Xt=m&&m.__awaiter||function(e,r,t,n){function c(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function d(o){try{u(n.next(o))}catch(f){s(f)}}function l(o){try{u(n.throw(o))}catch(f){s(f)}}function u(o){o.done?i(o.value):c(o.value).then(d,l)}u((n=n.apply(e,r||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});m.promisifiedActionWorkflow=void 0;var Yt=require("../node_modules/effect-errors/cjs/index.js"),Zt=Ae(),er=()=>Xt(void 0,void 0,void 0,function*(){yield(0,Yt.runPromise)((0,Zt.catchMainTaskErrors)())});m.promisifiedActionWorkflow=er});Object.defineProperty(exports,"__esModule",{value:!0});var tr=Ge();(0,tr.promisifiedActionWorkflow)();
